<!-- public/index.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamSquad - Prototype</title>
    <!-- Bootstrap CSS (Cahier des charges 3.2) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #222; color: white; }
        .hidden { display: none; }
        .room-container { border: 1px solid #444; padding: 20px; border-radius: 10px; background: #333; }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="text-center mb-5">
        <h1 class="text-primary">StreamSquad</h1>
        <p>Prototype de gestion de salon</p>
    </div>

    <!-- ÉCRAN D'ACCUEIL (LOGIN) -->
    <div id="home-screen" class="row justify-content-center">
        <div class="col-md-6">
            <div class="mb-3">
                <label for="username" class="form-label">Ton Pseudo</label>
                <input type="text" class="form-control" id="username" placeholder="Entrez votre pseudo...">
            </div>
            
            <div class="d-grid gap-2">
                <button class="btn btn-primary" id="btn-create">Créer un salon</button>
                
                <div class="input-group mt-3">
                    <input type="text" class="form-control" id="room-code-input" placeholder="Code du salon (ex: 123456)">
                    <button class="btn btn-success" id="btn-join">Rejoindre</button>
                </div>
            </div>
            <div id="error-msg" class="text-danger mt-3 text-center"></div>
        </div>
    </div>

    <!-- ÉCRAN DU SALON (Caché par défaut) -->
    <div id="room-screen" class="hidden">
        <div class="room-container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Salon : <span id="display-room-code" class="text-warning"></span></h2>
                <button class="btn btn-outline-danger" onclick="location.reload()">Quitter</button>
            </div>

            <div class="row">
                <!-- Zone Vidéo (Vide pour l'instant) -->
                <div class="col-md-8 bg-black d-flex align-items-center justify-content-center" style="height: 300px;">
                    <p class="text-muted">Le lecteur vidéo sera ici</p>
                </div>

                <!-- Liste des utilisateurs -->
                <div class="col-md-4">
                    <h4>Utilisateurs connectés</h4>
                    <ul id="users-list" class="list-group">
                        <!-- La liste sera remplie par JS -->
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();

    // Éléments du DOM
    const homeScreen = document.getElementById('home-screen');
    const roomScreen = document.getElementById('room-screen');
    const usernameInput = document.getElementById('username');
    const roomCodeInput = document.getElementById('room-code-input');
    const displayRoomCode = document.getElementById('display-room-code');
    const usersList = document.getElementById('users-list');
    const errorMsg = document.getElementById('error-msg');

    // 1. Créer un salon
    document.getElementById('btn-create').addEventListener('click', () => {
        const username = usernameInput.value;
        if (!username) return alert("Merci de mettre un pseudo !");
        
        socket.emit('create_room', username);
    });

    // 2. Rejoindre un salon
    document.getElementById('btn-join').addEventListener('click', () => {
        const username = usernameInput.value;
        const code = roomCodeInput.value;
        
        if (!username || !code) return alert("Pseudo et Code requis !");
        
        socket.emit('join_room', { roomCode: code, username: username });
    });

    // --- RÉPONSES DU SERVEUR ---

    // Quand le salon est créé ou rejoint avec succès
    socket.on('room_created', (code) => showRoom(code));
    socket.on('room_joined', (code) => showRoom(code));

    // Mise à jour de la liste des utilisateurs
    socket.on('update_users', (users) => {
        usersList.innerHTML = ""; // On vide la liste
        users.forEach(user => {
            const li = document.createElement('li');
            li.className = "list-group-item list-group-item-dark";
            li.textContent = user.username;
            usersList.appendChild(li);
        });
    });

    socket.on('error_message', (msg) => {
        errorMsg.textContent = msg;
    });

    // Fonction pour changer d'écran
    function showRoom(code) {
        homeScreen.classList.add('hidden');
        roomScreen.classList.remove('hidden');
        displayRoomCode.textContent = code;
        errorMsg.textContent = "";
    }
</script>

</body>
</html>


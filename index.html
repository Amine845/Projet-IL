<!-- index.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>StreamSquad - Accueil</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style> body { background-color: #222; color: white; } </style>
</head>
<body>
<div class="container mt-5 text-center">
    <h1 class="text-primary mb-4">StreamSquad</h1>
    
    <div class="row justify-content-center">
        <div class="col-md-4">
            <input type="text" id="username" class="form-control mb-3" placeholder="Votre pseudo">
            
            <button id="btn-create" class="btn btn-primary w-100 mb-3">Créer un salon</button>
            
            <div class="input-group">
                <input type="text" id="room-code" class="form-control" placeholder="Code salon">
                <button id="btn-join" class="btn btn-success">Rejoindre</button>
            </div>
        </div>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    const usernameInput = document.getElementById('username');

    // 1. CRÉER : On demande un code au serveur
    document.getElementById('btn-create').addEventListener('click', () => {
        const user = usernameInput.value;
        if(!user) return alert("Pseudo requis !");
        
        socket.emit('request_create_room');
    });

    // Le serveur nous donne un code -> on redirige
    socket.on('room_created', (code) => {
        const user = usernameInput.value;
        // Redirection vers room.html avec paramètres dans l'URL
        window.location.href = `/room?room=${code}&user=${user}`;
    });

    // 2. REJOINDRE : On redirige directement si on a le code
    document.getElementById('btn-join').addEventListener('click', () => {
        const user = usernameInput.value;
        const code = document.getElementById('room-code').value;
        
        if(!user || !code) return alert("Pseudo et Code requis !");
        
        window.location.href = `/room?room=${code}&user=${user}`;
    });
</script>
</body>
</html>